# IO Proxy Bot

> Version of [`README.ME` in English](./README.md).

Этот бот умеет перенаправлять сообщения из настроенного чата в `stdin` проксируемого приложения.

## Установка

Выполните несколько простых шагов:

```shell
# установите инструментарий `rust`
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# склонируйте репозиторий с исходным кодом
git clone https://github.com/ilyavenner/io-proxy-bot 

# установите исполняемый файл
cd io-proxy-bot && cargo install --path=.
```

## Настройка аккаунта бота

Если у вас нет бота, то создайте его у [BotFather](https://t.me/BotFather). Для использования в
групповых чатах включите эту возможность в настройках бота и отключите приватный режим
(дополнительный доступ к сообщениям участников, а не только к командам).

Для запуска бота необходимо передать следующие обязательные параметры:

* `token` - токен бота, который выдаёт [BotFather](https://t.me/BotFather);
* `chat` - идентификатор чата где будет работать бот (другие чаты будут игнорироваться);
* `executable` - путь к исполняемому файлу, который будет проксироваться.

Например:

```shell
io-proxy-bot --token 'bot-token:88005553535' --chat '42424242' --executable '/bin/cat'
```

Таким образом будет создан простейший эхо-бот. Обратите внимание, что у бота должны быть права
отправлять сообщения в указанном чате. Для прямого диалога с ботом вы должны были написать ему
первыми, для групп — добавить в чат.

> __Примечание__
> 
> Идентификатор своего аккаунта можно узнать у [@chatid_echo_bot](https://t.me/chatid_echo_bot).
> Чтобы узнать идентификатор группы, просто добавьте его в соответствующий чат.

### Настройка паузы между сообщениями

Если приложение будет отправлять слишком много текста, это может привести к превышению лимита
Telegram'а. Через опцию `--pause-duration` можно указать интервал между двумя отправляемыми
сообщениями (по умолчанию 2 секунды). С помощью команды ниже устанавливается интервал в 10 секунд:

```shell
io-proxy-bot ... --pause-duration 10s
```

### Фильтрация строк

Опцией `--filter-dictionary` можно настроить строки, которые будут исключены из отправляемых
сообщений. Полезно, если нужно отфильтровать ненужный текст. Обратите внимание, что строки ищутся по
полному совпадению с учётом регистра.

```shell
io-proxy-bot ... --filter-dictionary 'Dumping data...' 'Reboot...'
```

## Использование

В этом разделе описаны некоторые особенности использования бота.

### Комментарии

Все отправленные боту сообщения отправляются в `stdin` проксируемого приложения без изменений.
Строки, начинающиеся с символа `#`, являются комментариями и будут проигнорированы ботом.

### Скрипты

Если проксируемое приложение выполняет команды построчно, то опираясь на информацию из абзаца выше,
вы можете организовывать тест в несколько строк. Ниже приведён пример скрипта из псевдокоманд с
использованием комментариев:

```shell
# добавить игрока в белый список
whitelist add somebody

# сделать добавленного игрока админом 
setrole somebody admin
```

## Лицензия

Эта программа является свободным программным обеспечением: Вы можете распространять ее и (или)
изменять, соблюдая условия Генеральной публичной лицензии GNU Affero, опубликованной Фондом
свободного программного обеспечения; либо редакции 3 Лицензии, либо (на Ваше усмотрение) любой
редакции, выпущенной позже.

Эта программа распространяется в расчете на то, что она окажется полезной, но БЕЗ КАКИХ-ЛИБО
ГАРАНТИЙ, включая подразумеваемую гарантию КАЧЕСТВА либо ПРИГОДНОСТИ ДЛЯ ОПРЕДЕЛЕННЫХ ЦЕЛЕЙ.
Ознакомьтесь с Генеральной публичной лицензией GNU Affero для получения более подробной информации.
